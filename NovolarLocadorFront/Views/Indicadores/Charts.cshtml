@model NovolarLocadorFront.ViewModel.ChartsViewModel;

<br />
<br />
<br />
<br />
<div>
    <h3>Indicadores de @Model.Proprietario.st_nome_pes</h3>
</div>
<hr />
<input type="hidden" id="locadorId" value="@Model.Proprietario.id_pessoa_pes" />
<div class="container-fluid">
    <div>
        <h3>Relação Receitas x Despesas 2024 - Geral</h3>
    </div>
    <div class="form-group">
        <label for="condominioComboBox">Selecione o ano para consulta:</label>
        <select id="anoRepassesComboBox" asp-items="ViewBag.anoRepassesComboBox" class="form-control" onchange="handleSelectChangeAnoRepasses()">
        </select>
    </div>
</div>
<div class="row">
    <div class="col">
        <canvas id="repassesChart" class="w-60" height="155">
        </canvas>
    </div>
</div>

<div><br /><br /></div>
<hr />

<div class="container-fuid">
    <div class="container-fluid">
        <div>
            <h3>Variação do valor dos aluguéis</h3>
        </div>
        <div>
        <input type="radio" name="gender" value="Anual" >Amostra anual</input>&nbsp;
            <input type="radio" name="gender" value="Mensal" >Amostra Mensal</input>
        </div>
    </div>
    <div class="row">
        <div class="col" >
            <canvas id="myChart" class="w-60" height="240" >
            </canvas>
        </div>
    </div>
    <hr />
    <br />
   
    
    <div class="container-fluid">
        <div>
            <h3>Dados a serem definidos</h3>
        </div>
    </div>
    <div class="row">
        <div class="col col-12">
            <canvas id="myChart3" >
            </canvas>
        </div>
    </div>

</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

    <script>
        window.onload = function () {
            handleSelectChangeAnoRepasses();
        }
    </script>
   
    <script>
        function handleSelectChangeAnoRepasses() {
            var select = document.getElementById('anoRepassesComboBox');
            var ano = select.value;

            if(ano <= 0){
                ano = @DateTime.Now.Year;
            }

            if (ano > 0) {
                var url = '@Url.Action("RetornaCaixas", "indicadores")' + '/' + ano + '/' + @Model.Proprietario.id_favorecido_fav;
                console.log(url);
                $.ajax(
                    {
                        url: url,
                        type: 'GET',
                        success: function (data) {
                            montaChartRepassesPorAno(data);
                        },
                        error: function (xhr, status, error) {
                            console.error(error);
                        }
                    });
            }
        }

        function montaChartRepassesPorAno(caixaMeses) {
            const ctx2 = document.getElementById('repassesChart').getContext('2d');

            const meses = caixaMeses.meses; // Labels para o gráfico
            const valoresRepasses = caixaMeses.valoresRepasses; // Valores dos repasses
            const valoresDespesas = caixaMeses.valoresDespesas; // Valores das despesas (caso queira adicionar esse dado no gráfico)

            console.log(caixaMeses);

            
            //const _meses = meses;

            const DATA_COUNT = 5;
            const NUMBER_CFG = { count: DATA_COUNT, min: -100, max: 100 };
            const labels = meses;
            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'Receitas',
                        data: valoresRepasses,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    }
                ]
            };

            const config = {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Chart.js Bar Chart'
                        }
                    }
                }
            };

            new Chart(ctx2, config);
        }
    </script>
}
